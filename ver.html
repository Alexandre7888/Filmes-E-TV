<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Assistir Conte√∫do</title>
  <script type="module">
    // Import Firebase
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getDatabase, ref, child, get } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

    // Configura√ß√£o Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyC4THzGt-8NwPDmWuaqR4OTJR_6XbfbSvM",
      authDomain: "api7-5cde7.firebaseapp.com",
      databaseURL: "https://api7-5cde7-default-rtdb.firebaseio.com",
      projectId: "api7-5cde7",
      storageBucket: "api7-5cde7.appspot.com",
      messagingSenderId: "113015470459",
      appId: "1:113015470459:web:3ffd77031fb936d001a5de",
      measurementId: "G-DKEHN0SJV7"
    };

    // Inicializar Firebase
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // Obter token da URL
    const urlParams = new URLSearchParams(window.location.search);
    const token = urlParams.get("token");

    const contentDiv = document.getElementById("conteudo");

    if (!token) {
      contentDiv.innerHTML = "<h2 style='color:red;'>‚ùå Token n√£o encontrado na URL.</h2>";
    } else {
      const tokenRef = ref(db, "tokens/" + token);
      get(tokenRef).then(snapshot => {
        if (snapshot.exists()) {
          // Token v√°lido ‚Äî buscar conte√∫dos
          const filmesRef = ref(db, "conteudos/");
          get(filmesRef).then(contentSnap => {
            if (contentSnap.exists()) {
              const dados = contentSnap.val();
              for (let id in dados) {
                const item = dados[id];
                const card = document.createElement("div");
                card.style.border = "1px solid #ccc";
                card.style.padding = "10px";
                card.style.margin = "10px 0";
                card.innerHTML = `
                  <h3>${item.titulo}</h3>
                  <p>Categoria: ${item.categoria}</p>
                  <iframe width="100%" height="360" src="${item.link}" frameborder="0" allowfullscreen></iframe>
                `;
                contentDiv.appendChild(card);
              }
            } else {
              contentDiv.innerHTML = "<h2 style='color:orange;'>Nenhum conte√∫do encontrado.</h2>";
            }
          });
        } else {
          // Token inv√°lido
          contentDiv.innerHTML = "<h2 style='color:red;'>‚ùå Token inv√°lido. Acesso negado.</h2>";
        }
      }).catch(error => {
        contentDiv.innerHTML = `<h2 style='color:red;'>Erro ao verificar token: ${error}</h2>`;
      });
    }
  </script>
</head>
<body>
  <h1>üé¨ Filmes, S√©ries e TV</h1>
  <div id="conteudo">
    <p>Carregando conte√∫do...</p>
  </div>
</body>
</html>